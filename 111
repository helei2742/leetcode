select
    *
from
    (
        select
            a.busi_no,
            a.open_time,
            a.status,
            a.title,
            a.order_type,
            a.issue_domain,
            a.user_by,
            a.opened_user as open_by,
            cast(a.deal_time as TEXT) as supporter_stay_dur,
            a.curr_process_user as supporter,
            a.sla_time,
            a.respond_sla_status,
            a.closed_sla_status,
            a.spdt_code,
            a.spdt_name,
            a.pdt_code,
            a.pdt_name,
            a.sub_product_code,
            a.sub_product_name,
            a.module_code,
            a.module_cn_name,
            a.app_id,
            a.app_cn_name,
            a.l1_dept_code,
            a.l1_dept_cn_name,
            a.l2_dept_code,
            a.l2_dept_cn_name,
            a.l3_dept_code,
            a.l3_dept_cn_name,
            a.l4_dept_code,
            a.l4_dept_cn_name,
            a.l5_dept_code,
            a.l5_dept_cn_name,
            a.l6_dept_code,
            a.l6_dept_cn_name,
            a.relate_order_no as asso_number,
            cast(a.saty_time as TEXT) as resolve_duration,
            a.label_priority_01,
            a.label_priority_02,
            case
                when b.employee_name is not null then b.employee_name || ' ' || a.user_by
                else a.user_by
                end as user_name,
            a.to_do_person,
            a.to_do_applicant,
            a.trace_person,
            a.trace_upgrade
        from
            ioc3000.dwr_pub_yygzt_v2_td_order_realtime_full a
                left join ioc3000.dim_pub_rels_emp_dept_t b on lower (a.user_by) = lower(b.w3_account)
    ) a
where
    a.status not in ('已关闭', '已拒绝', '已取消')
order by
    sla_time desc nulls last,
    busi_no desc
